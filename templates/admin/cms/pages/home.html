{% extends "/admin/cms/interface/render.html" %}

{% block content %}

<!-- Pulsante per personalizzare la homepage -->
<button id="customize-homepage-btn" class="btn btn-dark btn-sm" data-bs-toggle="modal" data-bs-target="#customizationHomepageModal">
    <i class="fa-solid fa-cog"></i> Customize Homepage
</button>

<style>
#customize-homepage-btn {
    position: fixed;
    bottom: 20px;
    right: 20px; /* Cambiato da left a right */
    z-index: 1050;
    background-color: #212529;
    color: white;
    border-radius: 8px;
    padding: 10px 15px;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 5px;
    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
    transition: background-color 0.3s ease-in-out, transform 0.2s ease-in-out;
}

#customize-homepage-btn:hover {
    background-color: #343a40;
    transform: scale(1.05);
}
</style>

<style>
    /* Stile generale delle card */
.card {
    border-radius: 10px;
    transition: all 0.2s ease-in-out;
}

.card:hover {
    transform: scale(1.02);
}

/* Stile per il chatbox */
#chat-box {
    height: 280px;
    overflow-y: auto;
    background: #f8f9fa;
}

/* Stile per lo store card */
.store-card {
    position: relative;
    overflow: hidden;
    border-radius: 10px;
}

.store-card .card-img {
    height: 100%;
    object-fit: cover;
    filter: brightness(45%);
}

.store-card .card-img-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    color: white;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

/* Pulsanti con icone */
.card .btn i {
    margin-right: 5px;
}
</style>

<div class="row" data-aos="fade-up">

    <!-- AI Assistant -->
    <div id="assistant-container" class="col-md-6 mb-3">
        <div class="card shadow-sm">
            <div class="card-body text-center">
                <img class="mb-3" src="https://www.linkbay.it/static/image/lb-logo.svg" width="120px" alt="Logo LinkBay">
                <h5 class="card-title">AI Assistant</h5>
                
                <div id="chat-box" class="border rounded p-3 mb-3" style="height: 280px; overflow-y: auto; background: #f8f9fa;">
                    <!-- Chat messages will be added here -->
                </div>

                <div class="input-group">
                    <input type="text" id="user-input" class="form-control" placeholder="Ask anything...">
                    <button id="send-btn" class="btn btn-danger">Send</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Subscription Status -->
    <div id="subscription-status" class="col-md-6 mb-3">
        <div class="card shadow-sm">
            <div class="card-body text-center">
                <h5 class="card-title mb-3"><i class="fa-solid fa-credit-card"></i> Subscription Status</h5>
                <p class="text-muted"><i class="fa-solid fa-user"></i> <strong id="plan-name">Loading...</strong></p>
                <p class="text-muted"><i class="fa-solid fa-calendar"></i> Renewal Date: <strong id="renewal-date">Loading...</strong></p>
                <p class="text-muted"><i class="fa-solid fa-info-circle"></i> Status: <strong id="subscription-status-text">Loading...</strong></p>
                
                <div id="subscription-alert" class="alert alert-warning d-none">
                    <i class="fa-solid fa-triangle-exclamation"></i> Your subscription is expiring soon! <br>
                    <button id="renew-subscription" class="btn btn-danger btn-sm mt-2">
                        <i class="fa-solid fa-rotate"></i> Renew Now
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 🌍 Track Visitors -->
    <div id="visitor-map" class="col-md-6 mb-3">
        <div class="card shadow-sm">
            <div class="card-body">
                <h5 class="card-title"><i class="fa-solid fa-globe"></i> Visitor Map</h5>
                <div id="map-container"></div>
                <p class="text-muted text-center mt-2">
                    <i class="fa-regular fa-circle-dot text-danger"></i> <strong id="active-visitors">0</strong> Active Visitors
                    <br><small id="last-update">Waiting for update...</small>
                </p>
            </div>
        </div>
    </div>

        <!-- Sales Chart -->
        <div id="sales-chart" class="col-md-6 mb-3">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title"><i class="fa-solid fa-chart-line"></i> Sales Chart</h5>
                    <div style="height: 300px;">
                        <canvas id="salesChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    
        <!-- Latest Orders -->
        <div id="latest-orders" class="col-md-6 mb-3">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title"><i class="fa-solid fa-clipboard-list"></i> Latest Orders</h5>
                    <ul class="list-group list-group-flush" id="latestOrdersList">
                        <li class="list-group-item">Loading...</li>
                    </ul>
                </div>
            </div>
        </div>
    
        <!-- Recent Customers -->
        <div id="recent-customers" class="col-md-6 mb-3">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title"><i class="fa-solid fa-users"></i> Recent Customers</h5>
                    <ul class="list-group list-group-flush" id="recentCustomersList">
                        <li class="list-group-item">Loading...</li>
                    </ul>
                </div>
            </div>
        </div>
    
        <!-- Activity Feed -->
        <div id="activity-feed" class="col-md-6 mb-3">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title"><i class="fa-solid fa-bell"></i> Activity Feed</h5>
                    <ul class="list-group list-group-flush" id="activityFeedList">
                        <li class="list-group-item">Loading...</li>
                    </ul>
                </div>
            </div>
        </div>
    
        <!-- Best Selling Products -->
        <div id="best-selling-products" class="col-md-6 mb-3">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title"><i class="fa-solid fa-star"></i> Best Selling Products</h5>
                    <ul class="list-group list-group-flush" id="bestSellingProductsList">
                        <li class="list-group-item">Loading...</li>
                    </ul>
                </div>
            </div>
        </div>

</div>



<!-- Modal di configurazione per la homepage -->
<div class="modal fade" id="customizationHomepageModal" tabindex="-1" aria-labelledby="customizationHomepageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="customizationHomepageModalLabel">Customize Homepage Layout</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h6>Drag & Drop to Reorder Sections</h6>
                <div id="sortable-sections-grid" class="grid-container">
                    <!-- Sezioni della homepage generate dinamicamente -->
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Grid Layout */
.grid-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
}

/* Blocchi personalizzabili */
.grid-item {
    background: #f8f9fa;
    padding: 15px;
    text-align: center;
    border-radius: 8px;
    border: 1px solid #ddd;
    cursor: grab;
    display: flex;
    flex-direction: column;
    align-items: center;
}

/* Blocchi a larghezza completa */
.grid-item.full-width {
    grid-column: span 2;
}

/* Icone nei blocchi */
.grid-item i {
    font-size: 24px;
    margin-bottom: 5px;
}

/* Input checkbox nei blocchi */
.grid-item input {
    margin-top: 5px;
}

/* Effetto ghost mentre si spostano gli elementi */
.sortable-ghost {
    opacity: 0.5;
}

#sales-chart {
    min-height: 320px; /* Altezza minima del container */
}

#salesChart {
    width: 100% !important;
    height: 100% !important;
}
#map-container {
    width: 100%;
    height: 350px;
    border-radius: 8px;
    overflow: hidden;
}

/* Stile per i marker luminosi */
.custom-marker {
    background-color: rgba(255, 87, 87, 0.9);
    border-radius: 50%;
    width: 12px;
    height: 12px;
    box-shadow: 0px 0px 10px rgba(255, 87, 87, 0.8);
}
#subscription-status .card-body {
    font-size: 14px;
}

#subscription-alert {
    font-size: 14px;
    padding: 10px;
}
</style>

<script src="{{ url_for('static', filename="js/admin/home.js") }}"></script>
{% endblock %}