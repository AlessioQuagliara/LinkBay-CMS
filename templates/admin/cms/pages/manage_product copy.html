{% extends "/admin/cms/interface/render.html" %}

{% block content %}
<!-- CONTENUTO -->
<!-- CONTENUTO -->
<div class="container my-4" data-aos="fade-up">
    <!-- Product Form -->
    <form id="product-form">
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-dark">
                <h6 class="text-white mb-0">General Information</h6>
            </div>
            <div class="card-body">
                <input type="hidden" id="product-id" name="id" value="{{ product.id }}">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="name" class="form-label">Name</label>
                        <input type="text" class="form-control" id="name" name="name" value="{{ product.name }}" required>
                    </div>
                    <div class="col-md-6">
                        <label for="short_description" class="form-label">Short Description</label>
                        <input type="text" class="form-control" id="short_description" name="short_description" value="{{ product.short_description }}" required>
                    </div>
                    <div class="col-md-12">
                        <label for="description" class="form-label">Description</label>
                        <textarea class="form-control" id="description" name="description" rows="5" required>{{ product.description }}</textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pricing Section -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-dark">
                <h6 class="text-white mb-0">Pricing</h6>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="price" class="form-label">Price</label>
                        <input type="number" step="0.01" class="form-control" id="price" name="price" value="{{ product.price }}" required>
                    </div>
                    <div class="col-md-6">
                        <label for="discount_price" class="form-label">Discount Price</label>
                        <input type="number" step="0.01" class="form-control" id="discount_price" name="discount_price" value="{{ product.discount_price }}">
                    </div>
                </div>
            </div>
        </div>

        <!-- Inventory Section -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-dark">
                <h6 class="text-white mb-0">Inventory</h6>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="stock_quantity" class="form-label">Stock Quantity</label>
                        <input type="number" class="form-control" id="stock_quantity" name="stock_quantity" value="{{ product.stock_quantity }}" required>
                    </div>
                    <div class="col-md-6">
                        <label for="sku" class="form-label">SKU</label>
                        <input type="text" class="form-control" id="sku" name="sku" value="{{ product.sku }}" required>
                    </div>
                </div>
            </div>
        </div>

        <!-- Product Details Section -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-dark">
                <h6 class="text-white mb-0">Product Details</h6>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="category_id" class="form-label">Category</label>
                        <select class="form-select" id="category_id" name="category_id">
                            {% for category in categories %}
                            <option value="{{ category.id }}" {% if product.category_id == category.id %}selected{% endif %}>
                                {{ category.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="brand_id" class="form-label">Brand</label>
                        <select class="form-select" id="brand_id" name="brand_id">
                            {% for brand in brands %}
                            <option value="{{ brand.id }}" {% if product.brand_id == brand.id %}selected{% endif %}>
                                {{ brand.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dimensions & Weight Section -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-dark">
                <h6 class="text-white mb-0">Dimensions & Weight</h6>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-4">
                        <label for="weight" class="form-label">Weight</label>
                        <input type="number" step="0.01" class="form-control" id="weight" name="weight" value="{{ product.weight }}">
                    </div>
                    <div class="col-md-4">
                        <label for="dimensions" class="form-label">Dimensions</label>
                        <input type="text" class="form-control" id="dimensions" name="dimensions" value="{{ product.dimensions }}">
                    </div>
                    <div class="col-md-4">
                        <label for="color" class="form-label">Color</label>
                        <input type="text" class="form-control" id="color" name="color" value="{{ product.color }}">
                    </div>
                </div>
            </div>
        </div>

        <!-- Materials Section -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-dark">
                <h6 class="text-white mb-0">Materials</h6>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="material" class="form-label">Material</label>
                        <input type="text" class="form-control" id="material" name="material" value="{{ product.material }}">
                    </div>
                    <div class="col-md-6">
                        <label for="image_url" class="form-label">Image URL</label>
                        <input type="url" class="form-control" id="image_url" name="image_url" value="{{ product.image_url }}">
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Section -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-dark">
                <h6 class="text-white mb-0">Status</h6>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="slug" class="form-label">Slug</label>
                        <input type="text" class="form-control" id="slug" name="slug" value="{{ product.slug }}">
                    </div>
                    <div class="col-md-6">
                        <label for="is_active" class="form-label">Is Active</label>
                        <select class="form-select" id="is_active" name="is_active">
                            <option value="1" {% if product.is_active %}selected{% endif %}>Yes</option>
                            <option value="0" {% if not product.is_active %}selected{% endif %}>No</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const saveButton = document.getElementById('save-content');

    saveButton.addEventListener('click', () => {
        console.log("Save button clicked");

        const productForm = document.getElementById('product-form');
        const formData = new FormData(productForm);

        const requiredFields = ['name', 'price'];
        for (const field of requiredFields) {
            if (!formData.get(field)) {
                Swal.fire('Validation Error', `${field.charAt(0).toUpperCase() + field.slice(1)} is required.`, 'error');
                return;
            }
        }

        Swal.fire({
            title: 'Saving...',
            text: 'Please wait while your changes are being saved.',
            icon: 'info',
            allowOutsideClick: false,
            showConfirmButton: false,
            didOpen: () => Swal.showLoading()
        });

        fetch('/admin/cms/update_product', {
            method: 'POST',
            body: formData,
        })
        .then(response => response.json())
        .then(data => {
            console.log("Response:", data);
            if (data.success) {
                Swal.fire('Success', data.message, 'success');
            } else {
                Swal.fire('Error', data.message || 'Failed to update the product.', 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            Swal.fire('Error', 'A network or server error occurred.', 'error');
        });
    });
});
</script>
{% endblock %}




