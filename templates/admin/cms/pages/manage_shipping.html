{% extends "/admin/cms/interface/render.html" %}

{% block content %}

{% if method.shop_name == shop_subdomain %}
<div class="container my-4" data-aos="fade-up">

    <!-- General Information Section -->
    <div class="card shadow-sm mb-4">
        <div class="card-header bg-dark">
            <h6 class="text-white mb-0">General Information</h6>
        </div>
        <div class="card-body">
            <form id="shipping-method-form">
                <input type="hidden" id="method-id" name="id" value="{{ method.id }}">

                <!-- Nome e Stato -->
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="name" class="form-label">Shipping Method Name</label>
                        <input type="text" class="form-control" id="name" name="name" value="{{ method.name }}" required>
                    </div>
                    <div class="col-md-6">
                        <label for="is_active" class="form-label">Is Active</label>
                        <select class="form-select" id="is_active" name="is_active">
                            <option value="1" {% if method.is_active %}selected{% endif %}>Yes</option>
                            <option value="0" {% if not method.is_active %}selected{% endif %}>No</option>
                        </select>
                    </div>
                </div>

                <!-- Nazione e Regione -->
                <div class="row g-3 mt-3">
                    <div class="col-md-6">
                        <label for="country" class="form-label">Country</label>
                        <input type="text" class="form-control" id="country" name="country" value="{{ method.country }}" required>
                    </div>
                    <div class="col-md-6">
                        <label for="region" class="form-label">Region</label>
                        <input type="text" class="form-control" id="region" name="region" value="{{ method.region }}">
                    </div>
                </div>

                <!-- Costo e Tempi di Consegna -->
                <div class="row g-3 mt-3">
                    <div class="col-md-6">
                        <label for="cost" class="form-label">Cost</label>
                        <input type="number" class="form-control" id="cost" name="cost" value="{{ method.cost }}" step="0.01" required>
                    </div>
                    <div class="col-md-6">
                        <label for="estimated_delivery_time" class="form-label">Estimated Delivery Time</label>
                        <input type="text" class="form-control" id="estimated_delivery_time" name="estimated_delivery_time" value="{{ method.estimated_delivery_time }}">
                    </div>
                </div>

                <!-- Descrizione -->
                <div class="row g-3 mt-3">
                    <div class="col-12">
                        <label for="description" class="form-label">Description</label>
                        <textarea class="form-control" id="description" name="description" rows="5">{{ method.description }}</textarea>
                    </div>
                </div>
            </form>
        </div>
    </div>

</div>

{% else %}
<div class="d-flex align-items-center justify-content-center vh-100 bg-light">
    <div class="text-center">
        <h1 class="display-4 fw-bold text-muted">Content Unavailable</h1>
        <p class="lead text-secondary">
            The content you are looking for is currently unavailable. Please check back later or contact support for assistance.
        </p>
    </div>
</div>
{% endif %}



<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Pulsante di salvataggio
        const saveButton = document.getElementById('save-content');
        saveButton.addEventListener('click', () => {
            console.log("Save button clicked");
    
            const shippingForm = document.getElementById('shipping-method-form');
            const formData = new FormData(shippingForm);
    
            Swal.fire({
                title: 'Saving...',
                text: 'Please wait while your changes are being saved.',
                icon: 'info',
                allowOutsideClick: false,
                showConfirmButton: false,
                didOpen: () => Swal.showLoading()
            });
    
            fetch('/api/update_shipping_method', {
                method: 'POST',
                body: formData,
            })
                .then(response => response.json())
                .then(data => {
                    console.log("Response:", data);
                    if (data.success) {
                        Swal.fire('Success', data.message, 'success');
                    } else {
                        Swal.fire('Error', data.message || 'Failed to update the shipping method.', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    Swal.fire('Error', 'A network or server error occurred.', 'error');
                });
        });
    
        // Abilita il toggle per i campi di selezione (se necessario)
        const toggleFields = document.querySelectorAll('select, input[type="checkbox"]');
        toggleFields.forEach(field => {
            field.addEventListener('change', () => {
                console.log(`${field.name} changed to: ${field.value || field.checked}`);
            });
        });
    });
</script>
{% endblock %}