<script>
    // Gestione del pulsante "Select This"
    document.querySelectorAll('.confirm-select').forEach(button => {
        button.addEventListener('click', function() {
            const addonId = this.getAttribute('data-addon-id');
            const addonType = this.getAttribute('data-addon-type');
            const addonStatus = this.getAttribute('data-addon-status'); // Aggiungiamo l'attributo status
            
            if (addonStatus === 'purchased') {
                Swal.fire('Notice', 'This addon has already been purchased and cannot be re-selected.', 'info');
                return;
            }

            Swal.fire({
                title: 'Confirm Selection',
                text: "Are you sure you want to select this addon?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Yes, select it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    fetch('/api/select-addon', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ addon_id: addonId, addon_type: addonType })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            Swal.fire('Selected!', data.message, 'success').then(() => {
                                location.reload();
                            });
                        } else {
                            Swal.fire('Error', data.message, 'error');
                        }
                    });
                }
            });
        });
    });

    // Gestione del pulsante "Buy for â‚¬..."
    document.querySelectorAll('.confirm-purchase').forEach(button => {
        button.addEventListener('click', function() {
            const addonId = this.getAttribute('data-addon-id');
            const addonType = this.getAttribute('data-addon-type');
            const addonStatus = this.getAttribute('data-addon-status'); // Aggiungiamo l'attributo status

            if (addonStatus === 'purchased') {
                Swal.fire('Notice', 'This addon has already been purchased and cannot be bought again.', 'info');
                return;
            }

            Swal.fire({
                title: 'Confirm Purchase',
                text: "Do you want to purchase this addon?",
                icon: 'info',
                showCancelButton: true,
                confirmButtonText: 'Yes, buy it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    fetch('/api/purchase-addon', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ addon_id: addonId, addon_type: addonType })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            Swal.fire('Purchased!', data.message, 'success').then(() => {
                                location.reload();
                            });
                        } else {
                            Swal.fire('Error', data.message, 'error');
                        }
                    });
                }
            });
        });
    });
</script>

<script>
document.querySelectorAll('.apply-theme').forEach(button => {
    button.addEventListener('click', function () {
        const themeName = this.getAttribute('data-theme-name');
        const addonId = this.getAttribute('data-addon-id');
        const addonType = this.getAttribute('data-addon-type');

        // Conferma dell'azione
        Swal.fire({
            title: 'Apply Theme',
            text: `Are you sure you want to apply the theme "${themeName}"?`,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Yes, apply it!'
        }).then(result => {
            if (result.isConfirmed) {
                // Invio della richiesta al server
                fetch('/api/apply-theme', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ theme_name: themeName, addon_id: addonId, addon_type: addonType })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        Swal.fire('Success', data.message, 'success').then(() => {
                            location.reload(); // Ricarica la pagina
                        });
                    } else {
                        Swal.fire('Error', data.message, 'error');
                    }
                })
                .catch(err => Swal.fire('Error', 'Failed to apply theme', 'error'));
            }
        });
    });
});
</script>