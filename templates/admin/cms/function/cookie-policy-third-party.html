<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkBay-CMS - {{ title }}</title>
    {% include 'admin/cms/heading/admin_head.html' %}
    <style>
        /* Stili generali */
        body {
            background-color: #f8f9fa;
        }
        .sidebar {
            width: 250px;
            background-color: #343a40;
            color: white;
            position: fixed;
            height: 100vh;
            padding: 15px;
        }
        .content-container {
            margin-left: 250px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .partner-icons {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-bottom: 60px;
        }
        .partner-icons img {
            width: 180px;
            transition: transform 0.2s ease-in-out;
        }
        .partner-icons img:hover {
            transform: scale(1.1);
        }
        .main-content {
            display: flex;
            gap: 20px;
            justify-content: space-between;
            width: 100%;
            max-width: 1200px;
        }
        .instruction-card, .settings-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 48%;
        }
        .settings-container h3 {
            text-align: center;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    {% include 'admin/cms/ui/sidebar.html' %}

    <!-- Content Container -->
    <div class="content-container" data-aos="fade-up">

        <!-- Icons dei partner -->
        <div class="partner-icons mt-4">
            <img src="https://www.linkbay.it/static/image/iubenda.svg" alt="Iubenda" title="Iubenda">
            <img src="https://www.linkbay.it/static/image/cookiebot.svg" alt="Cookiebot" title="Cookiebot">
            <img src="https://www.linkbay.it/static/image/onetrust.svg" alt="OneTrust" title="OneTrust">
            <img src="https://www.linkbay.it/static/image/quantcast.svg" alt="Quantcast" title="Quantcast">
        </div>
                            
        <!-- Main Content -->
        <div class="main-content">
            <!-- Card Istruzioni -->
            <div class="instruction-card">
                <h4>How to Integrate Third-Party Cookies</h4>
                <p>To integrate a third-party cookie solution:</p>
                <ol>
                    <li>Visit the provider's website and create an account.</li>
                    <li>Customize your cookie banner settings as desired.</li>
                    <li>Copy the integration code provided by the platform.</li>
                    <li>Paste the code in the appropriate fields on the right.</li>
                </ol>
                <p>Supported providers include Iubenda, Cookiebot, OneTrust, and Quantcast. Be sure to test your implementation to ensure compliance.</p>
            </div>

            <!-- Form Settings Card -->
            <div class="settings-container">
                <h3>Third-Party Cookie Integration</h3>
                <form id="third-party-settings-form">
                    <div class="form-check mb-3">
                        <input type="checkbox" class="form-check-input" id="use-third-party" name="use_third_party" {% if cookie_settings.use_third_party %}checked{% endif %}>
                        <label for="use-third-party" class="form-check-label">Enable Third-Party Cookie Integration</label>
                    </div>

                    <!-- Fields for Third-Party Information -->
                    <div class="mb-3">
                        <label for="third-party-cookie" class="form-label">Cookie Policy Script</label>
                        <textarea id="third-party-cookie" class="form-control" name="third_party_cookie" rows="3">{{ cookie_settings.third_party_cookie }}</textarea>
                    </div>
                    <div class="mb-3">
                        <label for="third-party-privacy" class="form-label">Privacy Policy Script</label>
                        <textarea id="third-party-privacy" class="form-control" name="third_party_privacy" rows="3">{{ cookie_settings.third_party_privacy }}</textarea>
                    </div>
                    <div class="mb-3">
                        <label for="third-party-terms" class="form-label">Terms and Conditions Script</label>
                        <textarea id="third-party-terms" class="form-control" name="third_party_terms" rows="3">{{ cookie_settings.third_party_terms }}</textarea>
                    </div>
                    <div class="mb-3">
                        <label for="third-party-consent" class="form-label">User Consent Script</label>
                        <textarea id="third-party-consent" class="form-control" name="third_party_consent" rows="3">{{ cookie_settings.third_party_consent }}</textarea>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Script AJAX con SweetAlert -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        document.getElementById('save-content').addEventListener('click', function() {
        const useThirdParty = document.getElementById('use-third-party').checked;
        const thirdPartyCookie = document.getElementById('third-party-cookie').value;
        const thirdPartyPrivacy = document.getElementById('third-party-privacy').value;
        const thirdPartyTerms = document.getElementById('third-party-terms').value;
        const thirdPartyConsent = document.getElementById('third-party-consent').value;
    
        fetch("{{ url_for('cookiepolicy.cookie_setting_third_party') }}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest'  // Aggiungi questa intestazione
            },
            body: JSON.stringify({
                use_third_party: useThirdParty,
                third_party_cookie: thirdPartyCookie,
                third_party_privacy: thirdPartyPrivacy,
                third_party_terms: thirdPartyTerms,
                third_party_consent: thirdPartyConsent
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                Swal.fire({
                    icon: 'success',
                    title: 'Settings Saved',
                    text: 'The third-party cookie settings have been successfully saved.'
                });
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'There was an error saving the settings.'
                });
            }
        })
        .catch(error => {
            console.error('Error:', error);
            Swal.fire({
                icon: 'error',
                title: 'Network Error',
                text: 'Unable to save settings. Please try again later.'
            });
        });
    });
    </script>

    {% include 'admin/cms/footing/admin_footing.html' %}
</body>
</html>