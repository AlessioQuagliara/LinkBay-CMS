<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkBay - {{ title }}</title>
    {% include 'admin/cms/heading/admin_head.html' %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/editor.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/grapesjs/0.21.12/css/grapes.min.css" integrity="sha512-F+EUNfBQvAXDvJcKgbm5DgtsOcy+5uhbGuH8VtK0ru/N6S3VYM9OHkn9ACgDlkwoxesxgeaX/6BdrQItwbBQNQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <nav class="navbar navbar-dark d-md-none" style="background-color: #343a40;">
        <img src="{{ url_for('static', filename='images/lb-logo-w.svg') }}" width="200px" alt="Logo">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#sidebar" aria-controls="sidebar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
    </nav>
    <main class="d-flex">
        {% include 'admin/cms/ui/editor_bar.html' %}
        <div class="content" style="padding: 0 !important;">
            <div id="editor" style="height: 100vh;">{{ page.content | safe }}</div>
        </div>
    </main>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/grapesjs/0.21.12/grapes.min.js" integrity="sha512-teAIdSO6FfVceO6LRJjAix0YLUCdAWV8J304vAEMw0NQcqTPYWrSxeMVbLSdN/Kkq00Nm2yKL5836QpiyJ5ipg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var editor = grapesjs.init({
                container: '#editor',
                fromElement: true,
                height: '100vh',
                width: 'auto',
                storageManager: false,
                plugins: ['gjs-preset-webpage'],
                pluginsOpts: {
                    'gjs-preset-webpage': {}
                },
                canvas: {
                    styles: [
                        'https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css',
                        'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css'
                    ],
                    scripts: [
                        'https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js'
                    ]
                },
            });

            // Qui devo metterci i blocchi JS
            
            editor.BlockManager.add('bootstrap-header', {
                label: '<img src="https://via.placeholder.com/50x50.png?text=Header" alt="Header" /> Header',
                content: '<header class="bg-primary text-white text-center py-5"><h1>Welcome to LinkBay</h1></header>',
                category: 'Bootstrap'
            });
        
            editor.BlockManager.add('bootstrap-section', {
                label: '<img src="https://via.placeholder.com/50x50.png?text=Section" alt="Section" /> Section',
                content: '<section class="py-5"><div class="container"><div class="row"><div class="col-md-6"><h2>Section Title</h2><p>This is a sample section.</p></div><div class="col-md-6"><p>Another column in the section.</p></div></div></div></section>',
                category: 'Bootstrap'
            });
        
            editor.BlockManager.add('bootstrap-footer', {
                label: '<img src="https://via.placeholder.com/50x50.png?text=Footer" alt="Footer" /> Footer',
                content: '<footer class="bg-dark text-white text-center py-3"><p>&copy; 2024 LinkBay. All rights reserved.</p></footer>',
                category: 'Bootstrap'
            });
        
            editor.BlockManager.add('bootstrap-card', {
                label: '<img src="https://via.placeholder.com/50x50.png?text=Card" alt="Card" /> Card',
                content: '<div class="card" style="width: 18rem;"><img class="card-img-top" src="https://via.placeholder.com/150" alt="Card image cap"><div class="card-body"><h5 class="card-title">Card title</h5><p class="card-text">Some quick example text to build on the card title and make up the bulk of the card\'s content.</p><a href="#" class="btn btn-primary">Go somewhere</a></div></div>',
                category: 'Bootstrap'
            });

            

            document.getElementById('save-page').addEventListener('click', function() {
                var content = editor.getHtml();
                var slug = "{{ page.slug }}";

                fetch("{{ url_for('save_page') }}", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        id: {{ page.id }},
                        content: content
                    })
                }).then(response => response.json()).then(data => {
                    if (data.success) {
                        Swal.fire(
                            'Saved!',
                            'Your page has been successfully saved.',
                            'success'
                        );
                    } else {
                        Swal.fire(
                            'Error!',
                            'There was an error saving the page.',
                            'error'
                        );
                    }
                }).catch(error => {
                    console.error('Error:', error);
                    Swal.fire(
                        'Error!',
                        'There was an error saving the page.',
                        'error'
                    );
                });
            });
        });
    </script>
</body>
</html>