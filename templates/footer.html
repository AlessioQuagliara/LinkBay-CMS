    <!-- Sidebar del carrello -->
    <div id="cartSidebar" class="cart-sidebar">
        <div class="cart-sidebar-header">
            <h5>Il tuo Carrello</h5>
            <button type="button" class="btn btn-light" onclick="toggleCartSidebar()"><i class="fa-solid fa-times"></i></button></button>
        </div>
        <div class="cart-sidebar-body">
            <!-- Contenitore per i prodotti -->
            <div id="cartItemsContainer">
                <!-- I prodotti verranno iniettati qui via JS -->
            </div>
        </div>
        <div class="cart-sidebar-footer">
            <!-- Totali -->
            <div class="d-flex justify-content-between align-items-center mb-2">
                <span>Subtotale:</span>
                <strong id="cartSubtotal">€0.00</strong>
            </div>
            <div class="d-flex justify-content-between align-items-center mb-4">
                <span>Totale:</span>
                <strong id="cartTotal">€0.00</strong>
            </div>
            <!-- Pulsanti -->
            <button class="btn btn-dark w-100" onclick="proceedToCheckout()">Procedi al Checkout</button>
        </div>
    </div>

    <style>
        #addToCartButton.btn-success {
            background-color: #28a745;
            border-color: #28a745;
            color: white;
        }

        #addToCartButton.btn-danger {
            background-color: #dc3545;
            border-color: #dc3545;
            color: white;
        }
        .cart-sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 300px;
            height: 100%;
            background-color: #f8f9fa;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.3);
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
            z-index: 1050;
        }

        .cart-sidebar.open {
            transform: translateX(0);
        }

        .cart-sidebar-header {
            padding: 15px;
            background-color: #c6c6c6;
            color: black;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-sidebar-body {
            padding: 15px;
            overflow-y: auto;
            max-height: calc(100% - 160px); /* Header + Footer */
        }

        .cart-sidebar-footer {
            padding: 15px;
            border-top: 1px solid #ddd;
        }
    </style>

    <script>
        /* Funzione per aprire/chiudere la sidebar */
        function toggleCartSidebar() {
            const sidebar = document.getElementById('cartSidebar');
            sidebar.classList.toggle('open');
            if (sidebar.classList.contains('open')) {
                fetchCartContents();
            }
        }
        
        /* Recupera i contenuti del carrello dal backend */
        function fetchCartContents() {
            fetch('/cart_contents')
                .then(response => response.json())
                .then(data => {
                    if (data.cart) {
                        renderCartItems(data.cart);
                        updateCartTotals(data.cart);
                    }
                })
                .catch(error => console.error('Errore nel recupero del carrello:', error));
        }
        
        /* Mostra i prodotti nella sidebar */
        function renderCartItems(cart) {
            const cartItemsContainer = document.getElementById('cartItemsContainer');
            
            // Logga il contenitore per verificare che esista
            if (!cartItemsContainer) {
                console.error('Elemento con ID "cartItemsContainer" non trovato nel DOM.');
                return;
            }

            // Logga il contenuto del carrello
            console.log('Carrello ricevuto per il rendering:', cart);

            // Svuota il contenitore
            cartItemsContainer.innerHTML = '';

            // Controlla se il carrello è vuoto
            if (cart.length === 0) {
                cartItemsContainer.innerHTML = '<p>Il carrello è vuoto</p>';
                console.log('Carrello vuoto, messaggio impostato.');
                return;
            }

            // Itera attraverso i prodotti e crea l'HTML
            cart.forEach(item => {
                console.log('Rendering prodotto:', item); // Verifica i dati di ogni prodotto

                const productRow = document.createElement('div');
                productRow.classList.add('cart-item', 'd-flex', 'align-items-center', 'mb-3');

                // Genera l'HTML dinamico per il prodotto
                productRow.innerHTML = `
                    <div class="me-3">
                        <img src="${item.image || '/static/images/placeholder.png'}" 
                            alt="${item.name}" 
                            class="img-fluid" 
                            style="width: 50px; height: 50px; object-fit: cover;">
                    </div>
                    <div class="flex-grow-1">
                        <strong>${item.name}</strong><br>
                        <span class="text-muted">€${parseFloat(item.price).toFixed(2)}</span><br>
                        <span class="text-muted small">Quantità: ${item.quantity}</span>
                    </div>
                    <div>
                        <button class="btn btn-danger btn-sm" onclick="removeItemFromCart('${item.id}')">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </div>
                `;

                // Aggiungi il prodotto al contenitore
                cartItemsContainer.appendChild(productRow);
            });

            console.log('Prodotti renderizzati con successo.');
}
        
        /* Aggiorna i totali del carrello */
        function updateCartTotals(cart) {
            const subtotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
            const total = subtotal; // Eventualmente aggiungi tasse/spedizione
            document.getElementById('cartSubtotal').textContent = `€${subtotal.toFixed(2)}`;
            document.getElementById('cartTotal').textContent = `€${total.toFixed(2)}`;
        }
        
        /* Rimuove un prodotto dal carrello */
        function removeItemFromCart(productId) {
            fetch('/remove_from_cart', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ product_id: productId })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    fetchCartContents();
                }
            })
            .catch(error => console.error('Errore nella rimozione del prodotto:', error));
        }
        
        /* Procedi al checkout */
        function proceedToCheckout() {
            window.location.href = '/checkout';
        }
    </script>

    <script>
        // DROPDOWN NAVBAR --------------------------------------------------------------------------------------------------- 
        document.addEventListener('DOMContentLoaded', function () {
            const collectionsMenu = document.getElementById('collectionsMenu');
        
            // Ottieni il nome del negozio dal subdomain o altra fonte
            const shopName = "{{ shop_subdomain }}";
        
            // Effettua una richiesta AJAX per ottenere le collezioni
            fetch(`/api/collections?shop_name=${shopName}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.collections.length > 0) {
                        // Popola il dropdown con le collezioni
                        data.collections.forEach(collection => {
                            const listItem = document.createElement('li');
                            listItem.innerHTML = `<a class="dropdown-item" href="/collections/${collection.slug}">${collection.name}</a>`;
                            collectionsMenu.appendChild(listItem);
                        });
                    } else {
                        // Nessuna collezione trovata
                        const emptyItem = document.createElement('li');
                        emptyItem.innerHTML = `<span class="dropdown-item text-muted">No collections available</span>`;
                        collectionsMenu.appendChild(emptyItem);
                    }
                })
                .catch(error => {
                    console.error('Error fetching collections:', error);
                });
        });
    </script>

    