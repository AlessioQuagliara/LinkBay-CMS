<% if (!config || !config.enabled) { %>
  <!-- Cookie banner disabled -->
<% } else { %>
  <div id="cookie-banner" style="position:fixed;bottom:0;left:0;right:0;background:#fff;border-top:1px solid #ddd;padding:12px;z-index:9999;display:flex;justify-content:space-between;align-items:center;">
    <div style="flex:1;margin-right:12px"><%= config.banner_text || 'We use cookies to improve your experience. Manage your preferences.' %></div>
    <div>
      <button id="cookie-accept-all" class="btn">Accept all</button>
      <button id="cookie-accept-analytics" class="btn">Accept analytics</button>
      <button id="cookie-decline" class="btn">Decline</button>
    </div>
  </div>

  <script>
    (function(){
      function setConsent(obj){ document.cookie = `linkbay_cookie_consent=${encodeURIComponent(JSON.stringify(obj))}; path=/; max-age=${60*60*24*365}`; }
      function hide(){ var b=document.getElementById('cookie-banner'); if(b) b.style.display='none'; }
      function applyConsent(cons){
        // find script tags with data-cookie-category attribute and enable if consented
        document.querySelectorAll('script[data-cookie-category]').forEach(s=>{
          var cat = s.getAttribute('data-cookie-category');
          if(!cat) return;
          var allowed = !!cons[cat];
          if(allowed && s.getAttribute('data-src')){
            var src = s.getAttribute('data-src');
            var ns = document.createElement('script'); ns.src = src; ns.async = true; ns.setAttribute('data-cookie-category', cat); document.head.appendChild(ns);
          }
        });
      }
      document.getElementById('cookie-accept-all').addEventListener('click', ()=>{ setConsent({ necessary: true, analytics: true, marketing: true }); applyConsent({ necessary:true, analytics:true, marketing:true }); hide(); });
      document.getElementById('cookie-accept-analytics').addEventListener('click', ()=>{ setConsent({ necessary: true, analytics: true, marketing: false }); applyConsent({ necessary:true, analytics:true, marketing:false }); hide(); });
      document.getElementById('cookie-decline').addEventListener('click', ()=>{ setConsent({ necessary: true, analytics: false, marketing: false }); applyConsent({ necessary:true, analytics:false, marketing:false }); hide(); });
      // on load apply preferences if present
      try{
        var c = document.cookie.split(';').map(s=>s.trim()).find(s=>s.startsWith('linkbay_cookie_consent='));
        if(c){ var val = JSON.parse(decodeURIComponent(c.split('=')[1])); applyConsent(val); hide(); }
      }catch(e){}
    })();
  </script>
<% } %>
