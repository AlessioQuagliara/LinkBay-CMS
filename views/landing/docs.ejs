<main x-data="{ activeSection: 'overview', documentationData: {} }" 
      x-init="fetch('/docs/documentation_index.json')
        .then(response => response.json())
        .then(data => documentationData = data)
        .catch(error => console.error('Errore nel caricamento della documentazione:', error))"
      class="flex flex-col lg:flex-row min-h-screen">
    
    <!-- Sidebar Navigation -->
    <aside :class="darkMode ? 'lg:w-64 bg-gray-800 border-r border-gray-700' : 'lg:w-64 bg-gray-50 border-r border-gray-200'" 
           class="sticky top-16 h-[calc(100vh-4rem)] overflow-y-auto py-6 px-4 hidden lg:block">
        <nav class="space-y-1">
            <template x-if="documentationData.overview">
                <button @click="activeSection = 'overview'" 
                        :class="activeSection === 'overview' ? (darkMode ? 'bg-primary text-white' : 'bg-primary text-white') : (darkMode ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-700 hover:bg-gray-100')" 
                        class="w-full text-left px-4 py-2 rounded-md transition-colors flex items-center">
                    <i class="fas fa-info-circle mr-3"></i> Panoramica
                </button>
            </template>
            
            <template x-if="documentationData.categories">
                <button @click="activeSection = 'categories'" 
                        :class="activeSection === 'categories' ? (darkMode ? 'bg-primary text-white' : 'bg-primary text-white') : (darkMode ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-700 hover:bg-gray-100')" 
                        class="w-full text-left px-4 py-2 rounded-md transition-colors flex items-center">
                    <i class="fas fa-folder mr-3"></i> Categorie
                </button>
            </template>
            
            <template x-if="documentationData.revisions">
                <button @click="activeSection = 'revisions'" 
                        :class="activeSection === 'revisions' ? (darkMode ? 'bg-primary text-white' : 'bg-primary text-white') : (darkMode ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-700 hover:bg-gray-100')" 
                        class="w-full text-left px-4 py-2 rounded-md transition-colors flex items-center">
                    <i class="fas fa-history mr-3"></i> Cronologia Modifiche
                </button>
            </template>
        </nav>
    </aside>

    <!-- Mobile Navigation -->
    <div class="lg:hidden sticky top-16 z-10" :class="darkMode ? 'bg-gray-800' : 'bg-white'">
        <select @change="activeSection = $event.target.value" 
                :class="darkMode ? 'bg-gray-700 text-white border-gray-600' : 'bg-white text-gray-900 border-gray-300'" 
                class="w-full p-3 border-b focus:outline-none focus:ring-2 focus:ring-primary">
            <option value="overview">Panoramica</option>
            <option value="categories">Categorie</option>
            <option value="revisions">Cronologia Modifiche</option>
        </select>
    </div>

    <!-- Main Content -->
    <div class="flex-1 p-6">
        <!-- Loading State -->
        <div x-show="!documentationData.project" class="flex justify-center items-center h-64">
            <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"></div>
        </div>

        <!-- Overview Section -->
        <div x-show="activeSection === 'overview' && documentationData.project" 
             :class="darkMode ? 'bg-gray-800 text-white' : 'bg-white text-gray-900'" 
             class="rounded-lg p-6 shadow-md">
            <h2 class="text-2xl font-bold mb-4 flex items-center">
                <i class="fas fa-info-circle mr-2 text-primary"></i> 
                <span x-text="documentationData.project"></span> - Panoramica
            </h2>
            
            <div class="prose max-w-none" :class="darkMode ? 'prose-invert' : ''">
                <p class="text-lg mb-6" x-text="documentationData.overview"></p>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
                    <div :class="darkMode ? 'bg-gray-700' : 'bg-gray-100'" class="p-4 rounded-lg text-center">
                        <i class="fas fa-folder text-3xl mb-2 text-primary"></i>
                        <h3 class="font-semibold" x-text="'Categorie: ' + (documentationData.categories ? Object.keys(documentationData.categories).length : 0)"></h3>
                        <p class="text-sm">Documenti organizzati</p>
                    </div>
                    
                    <div :class="darkMode ? 'bg-gray-700' : 'bg-gray-100'" class="p-4 rounded-lg text-center">
                        <i class="fas fa-history text-3xl mb-2 text-primary"></i>
                        <h3 class="font-semibold" x-text="'Revisioni: ' + (documentationData.revisions ? documentationData.revisions.length : 0)"></h3>
                        <p class="text-sm">Modifiche registrate</p>
                    </div>
                    
                    <div :class="darkMode ? 'bg-gray-700' : 'bg-gray-100'" class="p-4 rounded-lg text-center">
                        <i class="fas fa-calendar text-3xl mb-2 text-primary"></i>
                        <h3 class="font-semibold" x-text="documentationData.generatedAt ? new Date(documentationData.generatedAt).toLocaleDateString('it-IT') : ''"></h3>
                        <p class="text-sm">Ultimo aggiornamento</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Categories Section -->
        <div x-show="activeSection === 'categories' && documentationData.categories" 
             :class="darkMode ? 'bg-gray-800 text-white' : 'bg-white text-gray-900'" 
             class="rounded-lg p-6 shadow-md">
            <h2 class="text-2xl font-bold mb-6 flex items-center">
                <i class="fas fa-folder mr-2 text-primary"></i> Categorie Documentazione
            </h2>
            
            <template x-for="(items, categoryName) in documentationData.categories" :key="categoryName">
                <div class="mb-8">
                    <h3 class="text-xl font-semibold mb-4 capitalize" x-text="categoryName"></h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <template x-for="item in items" :key="item.path">
                            <div :class="darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-50 hover:bg-gray-100'" 
                                 class="p-4 rounded-lg border transition-colors cursor-pointer">
                                <h4 class="font-semibold text-primary" x-text="item.title"></h4>
                                <p class="text-sm mt-2" x-text="item.summary"></p>
                                <div class="mt-3 flex justify-between items-center text-xs">
                                    <span :class="darkMode ? 'text-gray-400' : 'text-gray-500'" x-text="item.path"></span>
                                    <button :class="darkMode ? 'text-blue-400 hover:text-blue-300' : 'text-blue-600 hover:text-blue-800'" class="flex items-center">
                                        <i class="fas fa-external-link-alt mr-1"></i> Apri
                                    </button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </template>
        </div>

        <!-- Revisions Section -->
        <div x-show="activeSection === 'revisions' && documentationData.revisions" 
             :class="darkMode ? 'bg-gray-800 text-white' : 'bg-white text-gray-900'" 
             class="rounded-lg p-6 shadow-md">
            <h2 class="text-2xl font-bold mb-6 flex items-center">
                <i class="fas fa-history mr-2 text-primary"></i> Cronologia Modifiche
            </h2>
            
            <div class="relative">
                <!-- Timeline -->
                <div class="border-l-2 border-primary ml-4 pl-6 space-y-10">
                    <template x-for="(revision, index) in documentationData.revisions" :key="index">
                        <div class="relative">
                            <div class="absolute -left-7 mt-1.5 w-4 h-4 rounded-full bg-primary border-4" :class="darkMode ? 'border-gray-800' : 'border-white'"></div>
                            
                            <div :class="darkMode ? 'bg-gray-700' : 'bg-gray-50'" class="p-4 rounded-lg shadow">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-semibold" x-text="revision.note"></h4>
                                    <span class="text-sm whitespace-nowrap" x-text="revision.date"></span>
                                </div>
                                <div class="flex justify-between items-center text-sm">
                                    <span :class="darkMode ? 'text-gray-400' : 'text-gray-600'" x-text="'Autore: ' + revision.author"></span>
                                    <span class="px-2 py-1 rounded-full text-xs" 
                                          :class="revision.note.includes('feat') ? 'bg-green-100 text-green-800' : 
                                                  revision.note.includes('chore') ? 'bg-blue-100 text-blue-800' : 
                                                  revision.note.includes('fix') ? 'bg-red-100 text-red-800' : 
                                                  darkMode ? 'bg-gray-600 text-gray-300' : 'bg-gray-200 text-gray-700'"
                                          x-text="revision.note.includes('feat') ? 'Feature' : 
                                                  revision.note.includes('chore') ? 'Maintenance' : 
                                                  revision.note.includes('fix') ? 'Fix' : 'Update'">
                                    </span>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </div>
</main>