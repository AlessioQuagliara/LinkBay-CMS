<%- include('../layouts/boilerplate', { title: 'Subprocessors' }) %>

<main class="container">
  <h1>Subprocessors</h1>
  <p>Below is a list of third-party subprocessors used by this service, their purpose and the data centers/regions they operate in.</p>
  <div id="subprocessors-list">
    <%- JSON.stringify(subprocessors || []) %>
  </div>

  <script>
    (async function(){
      try {
        const res = await fetch('/api/subprocessors');
        const data = await res.json();
        const container = document.getElementById('subprocessors-list');
        if (!data || !data.subprocessors) { container.innerText = 'No data'; return; }
        const ul = document.createElement('ul');
        data.subprocessors.forEach(s => {
          const li = document.createElement('li');
          li.innerHTML = `<strong>${s.name}</strong> â€” ${s.purpose} <br/> Regions: ${Array.isArray(s.data_centers) ? s.data_centers.join(', ') : s.data_centers}`;
          ul.appendChild(li);
        });
        container.innerHTML = '';
        container.appendChild(ul);
      } catch (e) { console.error(e); }
    })();
  </script>
</main>
