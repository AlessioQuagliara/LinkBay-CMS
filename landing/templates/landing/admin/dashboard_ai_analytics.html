{% extends 'landing/base.html' %}
{% block content %}

<!-- HEADER UNIFORME -->
<div class="d-flex justify-content-between align-items-center mb-4 p-3 bg-white rounded shadow-sm">
  <div class="d-flex align-items-center">
    <i class="fas fa-brain fa-2x text-danger me-3"></i>
    <div>
      <h3 class="mb-0">Analisi Avanzate con AI</h3>
      <p class="text-muted mb-0">Esplora i dati del tuo shop con l'intelligenza artificiale</p>```  </div>
  </div>
  <a href="/dashboard" class="btn btn-outline-secondary">
    <i class="fas fa-arrow-left me-1"></i> Torna alla Dashboard
  </a>
</div>

<!-- DIVISORE -->
<div class="border-top border-danger border-2 my-4 opacity-75"></div>

<!-- CARDS ANALYTICS -->
<div class="row g-4" data-aos="fade-up">
  <!-- PREVISIONI VENDITE -->
  <div class="col-md-6">
    <div class="card border-0 shadow-sm h-100 rounded-4">
      <div class="card-body">
        <div class="d-flex align-items-center mb-3">
          <div class="bg-success bg-opacity-10 rounded-circle me-3 d-flex align-items-center justify-content-center" style="width:50px; height:50px;">
            <i class="fas fa-chart-line fa-lg text-success"></i>
          </div>
          <div>
            <h6 class="mb-0">Previsioni di Vendita</h6>
            <small class="text-muted">Andamento previsto nel tempo</small>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="salesForecastChart" height="200"></canvas>
        </div>
      </div>
    </div>
  </div>
  
  <!-- PRODOTTI TOP -->
  <div class="col-md-6">
    <div class="card border-0 shadow-sm h-100 rounded-4">
      <div class="card-body">
        <div class="d-flex align-items-center mb-3">
          <div class="bg-warning bg-opacity-10 rounded-circle me-3 d-flex align-items-center justify-content-center" style="width:50px; height:50px;">
            <i class="fas fa-trophy fa-lg text-warning"></i>
          </div>
          <div>
            <h6 class="mb-0">Prodotti pi√π Performanti</h6>
            <small class="text-muted">Classifica basata su AI</small>
          </div>
        </div>
        <ul id="topProductsAI" class="list-group list-group-flush"></ul>
      </div>
    </div>
  </div>
</div>

<!-- PULSANTE AIUTO -->
<button id="start-ai-tutorial" class="btn btn-danger position-fixed bottom-0 end-0 m-4 rounded-circle shadow"
        style="width:50px; height:50px;">
  <i class="fas fa-question"></i>
</button>

{% endblock %}

<style>
/* Hover effect per le card */
.card:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(220,53,69,0.15) !important;
  transition: all 0.3s ease;
}

/* Lista prodotti personalizzata */
#topProductsAI .list-group-item {
  border: none;
  padding: 0.75rem 0;
  border-bottom: 1px solid #f1f3f4;
}
#topProductsAI .list-group-item:last-child {
  border-bottom: none;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Grafico previsioni vendite
const ctx = document.getElementById('salesForecastChart').getContext('2d');
const salesForecastChart = new Chart(ctx, {
  type: 'line',
   {
    labels: ["Lun", "Mar", "Mer", "Gio", "Ven", "Sab", "Dom"],
    datasets: [{
      label: 'Vendite Previste',
       [120, 150, 170, 180, 140, 200, 220],
      fill: true,
      borderColor: '#ff5757',
      backgroundColor: 'rgba(255, 87, 87, 0.2)',
      tension: 0.4,
      borderWidth: 3,
      pointBackgroundColor: '#ff5757',
      pointBorderColor: '#fff',
      pointBorderWidth: 2,
      pointRadius: 6
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: { display: false }
    },
    scales: {
      y: {
        beginAtZero: true,
        grid: { color: '#f1f3f4' },
        ticks: { color: '#6c757d' }
      },
      x: {
        grid: { display: false },
        ticks: { color: '#6c757d' }
      }
    }
  }
});

// Lista prodotti top con icone
const topProducts = [
  { name: "T-shirt Basic", score: 95 },
  { name: "Scarpe Running", score: 89 },
  { name: "Zaino Impermeabile", score: 84 }
];

const list = document.getElementById('topProductsAI');
topProducts.forEach((product, index) => {
  const li = document.createElement('li');
  li.className = "list-group-item d-flex align-items-center justify-content-between";
  
  const iconColor = index === 0 ? 'text-warning' : index === 1 ? 'text-secondary' : 'text-info';
  const icon = index === 0 ? 'fa-crown' : index === 1 ? 'fa-medal' : 'fa-award';
  
  li.innerHTML = `
    <div class="d-flex align-items-center">
      <i class="fas ${icon} me-2 ${iconColor}"></i>
      <span>${product.name}</span>
    </div>
    <span class="badge bg-success">${product.score}%</span>
  `;
  list.appendChild(li);
});

// Tour guidato AI
document.addEventListener('DOMContentLoaded', () => {
  if (typeof Shepherd !== 'undefined') {
    const aiTour = new Shepherd.Tour({
      defaultStepOptions: {
        cancelIcon: { enabled: true },
        scrollTo: { behavior: 'smooth', block: 'center' },
        classes: 'shadow-lg bg-danger text-white',
        arrow: true
      },
      useModalOverlay: true
    });

    aiTour.addStep({
      title: '<i class="fas fa-chart-line"></i>&nbsp; Previsioni AI',
      text: 'L\'intelligenza artificiale analizza i tuoi dati per prevedere le```ndite future.',
      attachTo: { element: '#salesForecastChart', on: 'right```,
      buttons: [
        { text: 'Avanti', action: aiTour.next }
      ]
    });

    aiTour.addStep({
      title: '<i class="fas fa-trophy"></i>&nbsp; Top Prodotti',
      text: 'Questi sono i prodotti con le migliori performance secon```l\'analisi AI.',
      attachTo: { element: '#topProductsAI', on: 'left'```
      buttons: [
        { text: 'Indietro', action: aiTour.back },
        { text: 'Fatto!', action: aiTour.complete }
      ]
    });

    document.getElementById('start-ai-tutorial')
            .addEventListener('click', () => aiTour.start());
  }
});
</script>
