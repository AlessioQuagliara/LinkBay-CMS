{% extends 'landing/base.html' %}
{% block content %}

<!-- HEADER -->
<div class="mb-4 d-flex justify-content-between align-items-center">
  <a href="/home">
    <img src="/static/images/superadmin/linkbay_logo.png" width="150px" alt="Logo">
  </a>
  <a href="/logout" class="btn btn-danger" id="logout">Logout <i class="fa-solid fa-right-from-bracket"></i></a>
</div>

<!-- USER PROFILE -->
<div class="d-flex align-items-center mb-3" >
  <img src="{{ user['profilo_foto'] if user['profilo_foto'] else '/static/images/superadmin/user_extend.png' }}" id="user-avatar"
       alt="Avatar" class="rounded-circle me-3" width="55" height="55" style="object-fit: cover; border: 2px solid #ff5757;">
  <div>
    <h4 class="mb-0">Benvenuto, {{ user['nome'] or 'Utente' }} </h4>
    <small class="text-muted">Accedi rapidamente ai tuoi strumenti </small>
  </div>
</div>

<hr style="border: 0; height: 2px; background-color: red; margin: 20px 0;">

<!-- CONTENUTI DINAMICI -->
<div id="content9" class="content-pane" data-aos="fade-up">
  <!-- Card Negozi (STEP 1) -->
  <div class="card mb-4 shadow-sm border-0 rounded" id="store-management-card" style="max-width: 600px;">
    <div class="row g-0">
      <div class="col-md-4 d-flex align-items-center justify-content-center bg-light rounded">
        <i class="fa-solid fa-shop fa-4x text-danger"></i>
      </div>
      <div class="col-md-8">
        <div class="card-body">
          <h5 class="card-title text-dark">Gestisci i tuoi Negozi</h5>
          <p class="card-text">Accedi alla gestione dei tuoi negozi online.</p>
          <a href="/dashboard/stores" class="btn btn-outline-danger btn-sm">Vai ai Negozi</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Sezione News (STEP 2) -->
  <h4 id="news-section-title">Ultime Notizie</h4>
  <p id="news-section-desc">Rimani aggiornato con le ultime novità e aggiornamenti.</p>

  {% for news in notes %}
    <div class="card mb-4 shadow-sm border-0 rounded news-card" style="max-width: 600px;">
      <div class="card-body">
        <h5 class="card-title text-dark">{{ news.title }}</h5>
        <p class="card-text">{{ news.description }}</p>
        <a href="{{ news.link }}" target="_blank" class="btn btn-outline-secondary btn-sm" id="leggi-notizie-btn">Leggi di più</a>
      </div>
    </div>
  {% endfor %}
</div>

<!-- Pulsante Fisso Tutorial -->
<button id="start-tutorial" class="btn btn-danger position-fixed bottom-0 end-0 m-4 shadow">
  <i class="fa-solid fa-circle-info"></i> Aiuto
</button>

<script>
// Inizializzazione del tour con Shepherd.js
(function() {
  // Attende il caricamento completo della pagina
  document.addEventListener('DOMContentLoaded', function() {
    // Controllo di sicurezza
    if (typeof Shepherd === 'undefined') {
      console.error("Shepherd.js non caricato! Verifica i CDN.");
      return;
    }

    // Inizializzazione tour
    const tour = new Shepherd.Tour({
      defaultStepOptions: {
        cancelIcon: { enabled: true },
        scrollTo: { behavior: 'smooth', block: 'center' },
        classes: 'shadow-lg bg-danger text-white', // Stile personalizzato
        arrow: true
      },
      useModalOverlay: true
    });

    // Step 1: Gestione negozi
    tour.addStep({
      title: '<i class="fa-solid fa-store"></i>&nbsp; Gestione Negozi',
      text: 'Da questa card puoi gestire tutti i tuoi negozi online.',
      attachTo: {
        element: '#store-management-card',
        on: 'right'
      },
      buttons: [
        { text: 'Salta', action: tour.cancel },
        { text: 'Avanti', action: tour.next }
      ]
    });

    // Step 2
    tour.addStep({
      title: '<i class="fa-solid fa-user"></i>&nbsp; Il tuo Profilo',
      text: 'Consigliamo di modificare subito il nome profilo.',
      attachTo: {
        element: '#user-avatar',
        on: 'bottom'
      },
      buttons: [
        { text: 'Salta', action: tour.cancel },
        { text: 'Avanti', action: tour.next }
      ]
    });

    // Step 4
    tour.addStep({
      title: '<i class="fa-solid fa-list"></i>&nbsp; Sidebar',
      text: 'Con la sidebar puoi accedere a tutte le sezioni della piattaforma. Cliccando il tuo nome utente puoi accedere alle impostazioni del profilo.',
      attachTo: {
        element: '#sidebar',
        on: 'right'
      },
      buttons: [
        { text: 'Salta', action: tour.cancel },
        { text: 'Avanti', action: tour.next }
      ]
    });

    // Step 10: Sezione news
    tour.addStep({
      title: '<i class="fa-solid fa-newspaper"></i>&nbsp; Ultime Notizie',
      text: 'Qui trovi gli aggiornamenti importanti sulla piattaforma.',
      attachTo: {
        element: '#news-section-title',
        on: 'bottom'
      },
      buttons: [
        { text: 'Salta', action: tour.cancel },
        { text: 'Avanti', action: tour.next }
      ]
    });

    // Step 10: Sezione news
    tour.addStep({
      title: '<i class="fa-brands fa-readme"></i>&nbsp; Leggi ultimi aggiornamenti',
      text: 'Cliccando questo pulsante verrai catapultato su un link esterno per leggere gli ultimi aggiornamenti.',
      attachTo: {
        element: '#leggi-notizie-btn',
        on: 'bottom'
      },
      buttons: [
        { text: 'Salta', action: tour.cancel },
        { text: 'Avanti', action: tour.next }
      ]
    });

    // Step 10: Sezione news
    tour.addStep({
      title: '<i class="fa-brands fa-readme"></i>&nbsp; Uscire dalla piattaforma',
      text: 'Questo è il pulsante di logout per uscire dalla piattaforma, cliccandolo terminerai la sessione e dovrai effettuare il login.',
      attachTo: {
        element: '#logout',
        on: 'bottom'
      },
      buttons: [
        { text: 'Indietro', action: tour.back },
        { text: 'Completa', action: tour.next }
      ]
    });

    // Gestione stato del tour
    if (!sessionStorage.getItem('shepherdTourCompleted')) {
      setTimeout(() => tour.start(), 1000);
      tour.on('complete', () => {
        sessionStorage.setItem('shepherdTourCompleted', 'true');
      });
      tour.on('cancel', () => {
        sessionStorage.setItem('shepherdTourCompleted', 'true');
      });
    }

    // Avvio manuale
    document.getElementById('start-tutorial').addEventListener('click', () => {
      tour.start();
    });
  });
})();
</script>

{% endblock %}